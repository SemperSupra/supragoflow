# syntax=docker/dockerfile:1
FROM debian:trixie-slim

ARG GO_VERSION=1.25.7
ARG GOLANGCI_LINT_VERSION=2.9.0
ARG TARGETARCH

RUN apt-get update && apt-get install -y --no-install-recommends       ca-certificates git wget bash jq     && rm -rf /var/lib/apt/lists/*

RUN set -eux;     case "${TARGETARCH}" in       amd64) GOARCH=amd64 ;;       arm64) GOARCH=arm64 ;;       *) echo "unsupported TARGETARCH=${TARGETARCH}" >&2; exit 1 ;;     esac;     cd /tmp;     wget -q "https://dl.google.com/go/go${GO_VERSION}.linux-${GOARCH}.tar.gz";     wget -q "https://dl.google.com/go/go${GO_VERSION}.linux-${GOARCH}.tar.gz.sha256";     echo "$(cat "go${GO_VERSION}.linux-${GOARCH}.tar.gz.sha256")  go${GO_VERSION}.linux-${GOARCH}.tar.gz" | sha256sum -c -;     tar -C /usr/local -xzf "go${GO_VERSION}.linux-${GOARCH}.tar.gz";     rm -f /tmp/go*.tar.gz /tmp/go*.sha256

ENV PATH="/usr/local/go/bin:${PATH}:/go/bin"     GOPATH="/go"     GOCACHE="/go-cache"     GOMODCACHE="/go/pkg/mod"     CGO_ENABLED=0

# Install golangci-lint (latest by default, or set GOLANGCI_LINT_VERSION to pin)
RUN set -eux;     if [ "${GOLANGCI_LINT_VERSION}" = "latest" ]; then LINT_TAG="latest"; else LINT_TAG="v${GOLANGCI_LINT_VERSION#v}"; fi;     wget -qO- https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh       | sh -s -- -b /usr/local/bin "${LINT_TAG}";     golangci-lint version

# Install govulncheck (latest; can be pinned later if desired)
RUN set -eux;     go install golang.org/x/vuln/cmd/govulncheck@latest;     govulncheck -h >/dev/null

# Optional nicer test output
RUN set -eux;     go install gotest.tools/gotestsum@latest;     gotestsum --version >/dev/null || true

WORKDIR /work
CMD ["bash", "-lc", "go version && golangci-lint version && echo supragoflow-dev ready"]
